<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minhas Finan√ßas ‚Äî Controle de Gastos</title>
  <meta name="description" content="App simples de controle financeiro com login (Firebase), Firestore e gr√°ficos. Hospede no GitHub Pages." />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: '0 10px 25px -10px rgba(0,0,0,0.15)'
          }
        }
      }
    }
  </script>

  <!-- Chart.js (gr√°ficos) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    html, body { background: #0b1020; }
  </style>
</head>
<body class="min-h-screen text-slate-100">
  <header class="sticky top-0 z-10 bg-slate-900/80 backdrop-blur border-b border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">üí∏ Minhas Finan√ßas</h1>
      <div class="flex items-center gap-3">
        <span id="userEmail" class="text-slate-300 text-sm hidden"></span>
        <button id="btnLogout" class="hidden px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700">Sair</button>
      </div>
    </div>
  </header>

  <!-- Auth -->
  <main id="authSection" class="max-w-md mx-auto p-6 mt-10">
    <div class="bg-slate-900/70 border border-slate-800 rounded-2xl p-6 shadow-soft">
      <h2 class="text-2xl font-semibold mb-5">Entrar</h2>
      <form id="loginForm" class="space-y-3">
        <input id="loginEmail" type="email" required placeholder="Email" class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 outline-none focus:border-indigo-500" />
        <input id="loginPassword" type="password" required placeholder="Senha" class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 outline-none focus:border-indigo-500" />
        <button class="w-full py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500">Entrar</button>
      </form>

      <div class="my-6 h-px bg-slate-800"></div>

      <h3 class="text-lg font-medium">Criar conta</h3>
      <form id="registerForm" class="space-y-3 mt-2">
        <input id="regEmail" type="email" required placeholder="Email" class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 outline-none focus:border-indigo-500" />
        <input id="regPassword" type="password" minlength="6" required placeholder="Senha (m√≠n. 6)" class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 outline-none focus:border-indigo-500" />
        <button class="w-full py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500">Criar</button>
      </form>
      <p id="authMsg" class="text-sm text-rose-400 mt-4"></p>
    </div>
  </main>

  <!-- App -->
  <main id="appSection" class="hidden max-w-6xl mx-auto px-4 pb-20">
    <div class="grid gap-6 md:grid-cols-3 mt-8">
      <div class="md:col-span-2 bg-slate-900/70 p-6 rounded-2xl border border-slate-800 shadow-soft">
        <h2 class="text-xl font-semibold mb-4">Adicionar Gasto</h2>
        <form id="expenseForm" class="grid gap-3 sm:grid-cols-3">
          <input id="desc" type="text" required placeholder="Descri√ß√£o" class="px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" />
          <input id="amount" type="number" required placeholder="Valor" class="px-3 py-2 rounded-xl bg-slate-800 border border-slate-700" />
          <button class="px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500">Salvar</button>
        </form>
      </div>
      <div class="bg-slate-900/70 p-6 rounded-2xl border border-slate-800 shadow-soft">
        <h2 class="text-xl font-semibold mb-4">Saldo</h2>
        <p id="balance" class="text-3xl font-bold">R$ 0,00</p>
      </div>
    </div>

    <div class="bg-slate-900/70 mt-8 p-6 rounded-2xl border border-slate-800 shadow-soft">
      <h2 class="text-xl font-semibold mb-4">Hist√≥rico</h2>
      <ul id="history" class="space-y-2"></ul>
    </div>

    <div class="bg-slate-900/70 mt-8 p-6 rounded-2xl border border-slate-800 shadow-soft">
      <h2 class="text-xl font-semibold mb-4">Gr√°fico</h2>
      <canvas id="chart"></canvas>
    </div>
  </main>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyCOHtSTxM3uDD_vVurML1gJ1zMZz9YtP9o",
      authDomain: "planilha-gastos-a8665.firebaseapp.com",
      projectId: "planilha-gastos-a8665",
      storageBucket: "planilha-gastos-a8665.firebasestorage.app",
      messagingSenderId: "126522944194",
      appId: "1:126522944194:web:57a15e65b25a2f1216a95b",
      measurementId: "G-09TE1G2RMQ"
    };

    const [{ initializeApp },
           { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut },
           { getFirestore, collection, addDoc, query, where, orderBy, getDocs, deleteDoc }]
      = await Promise.all([
        import('https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js'),
        import('https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js'),
        import('https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js')
      ]);

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const authMsg = document.getElementById('authMsg');
    const btnLogout = document.getElementById('btnLogout');
    const userEmail = document.getElementById('userEmail');

    const expenseForm = document.getElementById('expenseForm');
    const history = document.getElementById('history');
    const balanceEl = document.getElementById('balance');

    const chartCtx = document.getElementById('chart').getContext('2d');
    let chart;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        authSection.classList.add('hidden');
        appSection.classList.remove('hidden');
        userEmail.textContent = user.email;
        userEmail.classList.remove('hidden');
        btnLogout.classList.remove('hidden');
        loadExpenses(user);
      } else {
        authSection.classList.remove('hidden');
        appSection.classList.add('hidden');
        btnLogout.classList.add('hidden');
        userEmail.classList.add('hidden');
        history.innerHTML = '';
        balanceEl.textContent = 'R$ 0,00';
      }
    });

    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const email = loginForm.loginEmail.value;
      const pass = loginForm.loginPassword.value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (err) {
        authMsg.textContent = err.message;
      }
    };

    registerForm.onsubmit = async (e) => {
      e.preventDefault();
      const email = registerForm.regEmail.value;
      const pass = registerForm.regPassword.value;
      try {
        await createUserWithEmailAndPassword(auth, email, pass);
      } catch (err) {
        authMsg.textContent = err.message;
      }
    };

    btnLogout.onclick = async () => signOut(auth);

    expenseForm.onsubmit = async (e) => {
      e.preventDefault();
      const desc = expenseForm.desc.value;
      const amount = parseFloat(expenseForm.amount.value);
      const user = auth.currentUser;
      if (!user) return;
      await addDoc(collection(db, 'expenses'), {
        uid: user.uid,
        desc,
        amount,
        created: new Date()
      });
      expenseForm.reset();
      loadExpenses(user);
    };

    async function loadExpenses(user) {
      const q = query(collection(db, 'expenses'), where('uid', '==', user.uid), orderBy('created', 'desc'));
      const snap = await getDocs(q);
      history.innerHTML = '';
      let total = 0;
      const labels = [];
      const values = [];
      snap.forEach(docu => {
        const d = docu.data();
        total += d.amount;
        const li = document.createElement('li');
        li.className = 'flex justify-between bg-slate-800 px-3 py-2 rounded-xl';
        li.innerHTML = `<span>${d.desc}</span><span>R$ ${d.amount.toFixed(2)}</span>`;
        history.appendChild(li);
        labels.push(d.desc);
        values.push(d.amount);
      });
      balanceEl.textContent = `R$ ${total.toFixed(2)}`;

      if (chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{ data: values, backgroundColor: ["#6366f1", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6"] }]
        }
      });
    }
  </script>
</body>
</html>
